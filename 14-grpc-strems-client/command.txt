#!/bin/bash

# Navigate to the client project directory
cd ~/go-udemy-course/14-grpc-streams-client

# Initialize Go module
rm -f go.mod go.sum
go mod init 14-grpc-streams-client

# Install dependencies
go get google.golang.org/grpc
go get google.golang.org/protobuf
go get google.golang.org/grpc/reflection
go mod tidy

# Ensure protoc plugins are installed
go install google.golang.org/protobuf/cmd/protoc-gen-go@latest
go install google.golang.org/grpc/cmd/protoc-gen-go-grpc@latest
export PATH=$PATH:$HOME/go/bin

# Create directory for generated files
mkdir -p grpcstreamclient/proto/gen

# Generate Protobuf and gRPC code
protoc --go_out=grpcstreamclient/proto/gen --go-grpc_out=grpcstreamclient/proto/gen proto/main.proto

# Run the client
go run client.go